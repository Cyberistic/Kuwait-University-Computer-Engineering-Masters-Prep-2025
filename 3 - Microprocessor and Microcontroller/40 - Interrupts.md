Interrupt System and related topics.

idk what related topics are

Interrupts are signals that cause the processor to temporarily stop its current execution and handle some other task (the interrupt service routine or ISR).

## Interrupt vs polling

- Polling: CPU checks status of devices at regular intervals to see if they need attention.
- Interrupt: Device signals CPU when it needs attention to execute ISR (interrupt service routine).

## Advantages of Interrupts

- Interrupts are more efficient as they allow the CPU to perform other tasks until an event occurs.
- Don't waste CPU time checking status of devices (busy spinning).
- Priority-based handling of multiple interrupts is easily defined.
- Can control which device can interrupt the CPU (masking devices).

## Types of Interrupts

1. **Hardware Interrupts**

   - External events (INT0, INT1)
   - Timer overflow (TF0, TF1)
   - Serial communication (RI, TI)

2. **Software Interrupts**
   - Generated by software instructions
   - Used for system calls

> [!Note] We can test software interrupts by setting TFx to 1 in the TCON register (even if the timer is not running).

## ISR (Interrupt Service Routine)

- A special function that executes when an interrupt occurs.
- Every ISR is located in a fixed address in memory.
- Addresss are defined in the interrupt vector table.
- When it finishes, it returns RETI (Return from Interrupt) to resume the main program.

## Interrupt Priority

| Interrupt Source | Priority |
| ---------------- | -------- |
| Reset            | Highest  |
| External 0       | ↓        |
| Timer 0          | ↓        |
| External 1       | ↓        |
| Timer 1          | ↓        |
| Serial           | Lowest   |

> [!Note] We can change the priority of interrupts using the IP register.
> By setting the bit, we make the interrupt highest priority.
> However, if more than one bit is set, it will follow the order in the table above.

> [!Note] The reset interrupt has the highest priority and is non-maskable.
> Located at address 0000H in the interrupt vector table. (Sends the program to initial address 0000H)

## Interrupt Enable Register (IE)

![[IE-Register.png]]

```
EA  - Enable All (Global enable)
ES  - Enable Serial
ET1 - Enable Timer 1
EX1 - Enable External 1
ET0 - Enable Timer 0
EX0 - Enable External 0
```

Example: Enable Timer 0 interrupt:

```NASM
SETB EA      ; Enable all interrupts
SETB ET0     ; Enable Timer 0 interrupt
```

## Example: Timer Interrupt

Create a 1-second delay using Timer 0 interrupt:

```NASM
ORG 0000H
    LJMP Main

ORG 000BH            ; Timer 0 vector in interrupt vector table
    LJMP Timer0_ISR

ORG 0030H
Main:
    MOV TMOD, #01H   ; Timer 0, Mode 1
    MOV TH0, #3CH    ; Initial values for
    MOV TL0, #0B0H   ; 50ms delay
    SETB EA          ; Enable all interrupts
    SETB ET0         ; Enable Timer 0
    SETB TR0         ; Start Timer 0
    SJMP $           ; Wait here

Timer0_ISR:
    MOV TH0, #3CH    ; Reload timer
    MOV TL0, #0B0H

    ; Your code here

    RETI            ; Return from interrupt
```
